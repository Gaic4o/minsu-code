"use strict";(self.webpackChunkminsucode_front=self.webpackChunkminsucode_front||[]).push([[591],{8591:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var r=n(2309),a=n(2545),o=n(8678),l=n(2951),c=n(3564),i=n(8667),u=n(9669),s=n.n(u),f=n(7294),m=n(5977),d=n(9249),p=n(8575),h=n(9732),v=n(5692),g=n(3046);function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const b=function(e){var t,n,r=e.show,a=e.onCloseModal,l=e.setShowInviteChannelModal,i=(0,m.UO)(),u=i.workspace,h=i.channel,b=(t=(0,o.Z)(""),n=3,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{l||null==n.return||n.return()}finally{if(c)throw a}}return o}}(t,n)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),w=b[0],S=b[1],C=b[2],k=(0,p.ZP)("/api/users",c.Z).data,E=(0,p.ZP)(k?"/api/workspaces/".concat(u,"/channels/").concat(h,"/members"):null,c.Z).revalidate,T=(0,f.useCallback)((function(e){e.preventDefault(),w&&w.trim()&&s().post("/api/workspaces/".concat(u,"/channels/").concat(h,"/members"),{email:w}).then((function(){E(),l(!1),C("")})).catch((function(e){var t;console.dir(e),d.Am.error(null===(t=e.response)||void 0===t?void 0:t.data,{position:"bottom-center"})}))}),[w]);return f.createElement(v.Z,{show:r,onCloseModal:a},f.createElement("form",{onSubmit:T},f.createElement(g.__,{id:"member-label"},f.createElement("span",null,"채널 멤버 초대"),f.createElement(g.II,{id:"member",value:w,onChange:S})),f.createElement(g.zx,{type:"submit"},"초대하기")))};function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{l||null==n.return||n.return()}finally{if(c)throw a}}return o}}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const k=function(){var e,t,n,u=(0,m.UO)(),v=u.workspace,g=u.channel,y=(0,p.ZP)("/api/users",c.Z).data,k=w((0,o.Z)(""),3),E=k[0],T=k[1],A=k[2],I=(0,p.ZP)("/api/workspaces/".concat(v,"/channels/").concat(g),c.Z).data,Z=(0,p.g_)((function(e){return"/api/workspaces/".concat(v,"/channels/").concat(g,"/chats?perPage=20&page=").concat(e+1)}),c.Z),_=Z.data,D=Z.mutate,j=Z.revalidate,O=Z.setSize,M=(0,p.ZP)(y?"/api/workspaces/".concat(v,"/channels/").concat(g,"/members"):null,c.Z).data,U=w((0,f.useState)(!1),2),x=U[0],B=U[1],P=w((0,f.useState)(!1),2),z=P[0],F=P[1],R=w((0,l.Z)(v),1)[0],H=0===(null==_||null===(e=_[0])||void 0===e?void 0:e.length),N=H||_&&(null===(t=_[_.length-1])||void 0===t?void 0:t.length)<20||!1,V=(0,f.useRef)(null),W=(0,f.useCallback)((function(e){if(e.preventDefault(),null!=E&&E.trim()&&_&&I){var t=E;D((function(e){var n;return null==e||e[0].unshift({id:((null===(n=_[0][0])||void 0===n?void 0:n.id)||0)+1,content:t,UserId:y.id,User:y,ChannelId:I.id,Channel:I,createdAt:new Date}),e}),!1).then((function(){var e;localStorage.setItem("".concat(v,"-").concat(g),(new Date).getTime().toString()),A(""),V.current&&(console.log("scrollToBottom!",null===(e=V.current)||void 0===e?void 0:e.getValues()),V.current.scrollToBottom())})),s().post("/api/workspaces/".concat(v,"/channels/").concat(g,"/chats"),{content:E}).then((function(){j(),A("")})).catch(console.error)}}),[E,v,y,I,_,g]),$=(0,f.useCallback)((function(e){e.Channel.name===g&&e.UserId!==(null==y?void 0:y.id)&&D((function(t){return null==t||t[0].unshift(e),t}),!1).then((function(){var e;V.current&&(V.current.getScrollHeight()<V.current.getClientHeight()+V.current.getScrollTop()+150?(console.log("scrollToBottom!",null===(e=V.current)||void 0===e?void 0:e.getValues()),setTimeout((function(){var e;null===(e=V.current)||void 0===e||e.scrollToBottom()}),100)):d.Am.success("새 메시지가 도착했습니다.",{onClick:function(){var e;null===(e=V.current)||void 0===e||e.scrollToBottom()},closeOnClick:!0}))}))}),[g,y]);(0,f.useEffect)((function(){return null==R||R.on("message",$),function(){null==R||R.off("message",$)}}),[R,onmessage]),(0,f.useEffect)((function(){var e;1===(null==_?void 0:_.length)&&(null===(e=V.current)||void 0===e||e.scrollToBottom())}),[]),(0,f.useEffect)((function(){localStorage.setItem("".concat(v,"-").concat(g),(new Date).getTime().toString())}),[v,g]);var K=(0,f.useCallback)((function(e){e.preventDefault(),console.log(e);var t=new FormData;if(e.dataTransfer.items){for(var n=0;n<e.dataTransfer.items.length;n++)if(console.log(e.dataTransfer.items[n]),"file"===e.dataTransfer.items[n].kind){var r=e.dataTransfer.items[n].getAsFile();console.log(e,".... file["+n+"].name = "+r.name),t.append("image",r)}}else for(var a=0;a<e.dataTransfer.files.length;a++)console.log(e,"... file["+a+"].name = "+e.dataTransfer.files[a].name),t.append("image",e.dataTransfer.files[a]);s().post("/api/workspaces/".concat(v,"/channels/").concat(g,"/images"),t).then((function(){F(!1),localStorage.setItem("".concat(v,"-").concat(g),(new Date).getTime().toString())}))}),[v,g]),q=(0,f.useCallback)((function(e){e.preventDefault(),console.log(e),F(!0)}),[]),G=(0,f.useCallback)((function(){B(!0)}),[]),J=(0,f.useCallback)((function(){B(!1)}),[]);if(!y||!y)return null;var L,Q=(0,i.Z)(_?(n=[]).concat.apply(n,(L=_,function(e){if(Array.isArray(e))return C(e)}(L)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(L)||S(L)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).reverse():[]);return f.createElement(h.W2,{onDrop:K,onDragOver:q},f.createElement(h.h4,null,f.createElement("span",null,"#",g),f.createElement("div",{style:{display:"flex",flex:1,justifyContent:"flex-end",alignItems:"center"}},f.createElement("span",null,null==M?void 0:M.length),f.createElement("button",{onClick:G,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},f.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),f.createElement(a.Z,{chatSections:Q,scrollRef:V,setSize:O,isEmpty:H,isReachingEnd:N}),f.createElement(r.Z,{chat:E,onChangeChat:T,onSubmitForm:W}),f.createElement(b,{show:x,onCloseModal:J,setShowInviteChannelModal:B}),z&&f.createElement(h.KW,null,"업로드!"))}}}]);